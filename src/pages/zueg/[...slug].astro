---
import { type CollectionEntry, getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Comments from "../../components/Comments.astro";
import { SITE_TITLE } from "../../consts";

export async function getStaticPaths() {
    const zuegEntries = await getCollection("zueg");
    return zuegEntries.map((entry) => ({
        params: { slug: entry.id },
        props: entry,
    }));
}

type Props = CollectionEntry<"zueg">;

const entry = Astro.props;
const { Content } = await render(entry);
---

<BaseLayout
    title={`${entry.data.title} | ${SITE_TITLE}`}
    description={entry.data.description || "随笔文章"}
>
    <main>
        <article>
            <div class="prose">
                <div class="title">
                    <div class="date">
                        <FormattedDate date={entry.data.pubDate} />
                        {entry.data.updatedDate && (
                            <div class="last-updated-on">
                                最后更新于 <FormattedDate date={entry.data.updatedDate} />
                            </div>
                        )}
                    </div>
                    <h1>{entry.data.title}</h1>
                    {entry.data.tags && (
                        <div class="tags">
                            {entry.data.tags.map((tag) => (
                                <span class="tag">#{tag}</span>
                            ))}
                        </div>
                    )}
                    <hr />
                </div>
                <Content />
            </div>
            
            <!-- 评论区 -->
            <Comments />
        </article>
    </main>
</BaseLayout>

<style>
	main {
		width: calc(100% - 2em);
		max-width: 100%;
		margin: 0;
	}
	.prose {
		width: min(120vw, 1000px);
		max-width: calc(100% - 2em);
		margin: auto;
		padding: clamp(1em, 3vw, 2em);
		color: rgb(var(--gray-dark));
		line-height: 1.8;
		font-size: 1.0625rem;
	}
	.title {
		margin-bottom: 1em;
		padding: 1em 0;
		text-align: center;
		line-height: 1;
	}
	.title h1 {
		margin: 0 0 0.5em 0;
	}
	.date {
		margin-bottom: 0.5em;
		color: rgb(var(--gray));
	}
	.last-updated-on {
		font-style: italic;
	}
	.tags {
		margin: 0.5em 0;
		display: flex;
		flex-wrap: wrap;
		gap: 0.5em;
		justify-content: center;
	}
	.tag {
		padding: 0.25em 0.75em;
		font-size: 0.875rem;
		background-color: rgb(var(--accent-light));
		color: rgb(var(--accent-dark));
		border-radius: 999px;
	}
</style>
